<!DOCTYPE html>
<html>
<head>

	<style>

		body {
			font-family: Verdana;
			background-color: #d0e4fe;
		}

		.div_pantalla {
			display			: flex;
			flex-flow		: column wrap;
			align-items		: center;
			align-content	: center;
		}

		.opcio {
			background-color: #e4fed0;
			padding			: 12px;
			width			: 90%;
			border: solid 3px #d0e4fe;
		}

		.opcio_sel {
			// background-color: #eeee88;
			cursor 			: pointer;
			border: solid 3px #888888;
		}

		.opcio_error {
			background-color: #ee5555;
			border: solid 3px #ee2222;
		}

		.opcio_ok {
			background-color: #55cc55;
			border: solid 3px #33ff33;
		}

		table {
			border-collapse: collapse;
			background-color: rgb(170, 210, 255);
    		color: #333333;
			font-size: 12px;
		}
		table, th, td { border: 1px solid black; }
		th { background-color: rgb(50, 150, 255); }
		td { padding: 2px; }



	</style>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>

  	<script src="jquery-ui/jquery-ui.js"></script>

	<script>
		var words = [
		{ word: 'chest', 			tipus: 'N', 	attempts: 0, res_ok: 0, meaning: 'pit' },
		{ word: 'waist', 			tipus: 'N', 	attempts: 0, res_ok: 0, meaning: 'cintura' },
		{ word: 'limbs', 			tipus: 'N', 	attempts: 0, res_ok: 0, meaning: 'extremitats, braços i cames' },
		{ word: 'lung', 			tipus: 'N', 	attempts: 0, res_ok: 0, meaning: 'pulmó' },
		{ word: 'heel', 			tipus: 'N', 	attempts: 0, res_ok: 0, meaning: 'taló' },
		{ word: 'belly', 			tipus: 'N', 	attempts: 0, res_ok: 0, meaning: 'ventre, panxa' },
		{ word: 'hip', 			tipus: 'N', 	attempts: 0, res_ok: 0, meaning: 'cadera' },
		{ word: 'forehead', 		tipus: 'N', 	attempts: 0, res_ok: 0, meaning: 'front, (front de la cara)' },
		{ word: 'brow', 			tipus: 'N', 	attempts: 0, res_ok: 0, meaning: 'front, (front de la cara)' },
		{ word: 'eyebrow', 		tipus: 'N', 	attempts: 0, res_ok: 0, meaning: 'cella' },
		{ word: 'cheek', 			tipus: 'N', 	attempts: 0, res_ok: 0, meaning: 'galta, mejilla' }
		];
		var play_words = $.extend(true, [], words);
		var num_quest;
		var resposta_correcta;
		var total_punts;
		var contador_timer;
		var temps_partida;

		// Retorna un array (llista) sense l'objecte de la posició num (re-ubicant els següents objectes per no deixar la posició buida)
		function pop_array(llista, num) { return llista.slice(0, num).concat(llista.slice(num + 1)); }

		function iron_up_str(str_input1) {
		  return  str_input1.replace(/à/g, 'a')
							.replace(/é/g, 'e')
							.replace(/è/g, 'e')
							.replace(/í/g, 'i')
							.replace(/ó/g, 'o')
							.replace(/ò/g, 'o')
							.replace(/ú/g, 'u')
							.trim();
		}


		/*********************************************************************************************************************/


		function consulta_doc() {
		  // alert('exe consulta doc');

		  google.script.run
			 .withSuccessHandler(function(contents) {
				  // Respond to success conditions here.
				  // alert('funcio_after_ok');
				  for (var i = 0; i < contents.children.length; i++) {
					var name = contents.children[i];
					$('#results').append('<div>' + i + ' - ' + name + '</div>');
				  }
				})
			 .withFailureHandler(function(msg) {
				  // Respond to failure conditions here.
				  $('#main-heading').text(msg);
				  $('#main-heading').addClass("error");
				  $('#error-message').show();
				})
			 .consultar_Doc(); // Macro de la Google API
		}


		function modificar_doc() {
		  google.script.run
			 .withSuccessHandler(function(contents) {
				  // Respond to success conditions here.
				  $('#results').append('<div> DOC modificat </div>');
				})
			 .withFailureHandler(function(msg) {
				  // Respond to failure conditions here.
				  $('#main-heading').text(msg);
				  $('#main-heading').addClass("error");
				  $('#error-message').show();
				})
			 .modificar_Doc(); // Macro de la Google API
		}


		function carregar_llista() {

		  google.script.run
			.withSuccessHandler(function(contents) {
				// Respond to success conditions here.
				for (var i = 1; i < contents.length; i++) words.push(contents[i]);
				$('#start_button').click(iniciar_partida);
			})
			.withFailureHandler(function(msg) {
				// Respond to failure conditions here.
				$('#main-heading').text(msg);
				$('#main-heading').addClass("error");
				$('#error-message').show();
			})
			.consultar_Doc(); // Macro de la Google API
		}


		/*********************************************************************************************************************/

		$(function() {
		  // alert('iniciant execucio');
		  // carregar_llista();
		  $('#start_button').click(iniciar_partida);
		});




		/******************************************************************************/
		/* Funció per iniciar els paràmetres de la partida                            */
		/******************************************************************************/
		function iniciar_partida() {

		  alert('ini partida');

		  // Mostra els objectes de la partida
		  $('#id_div_inici').hide();
		  $('#id_div_joc').show();

		  // Crea el array de les paraules de la partida, i el reordena
		  play_words = [];
		  var words_tmp = $.extend(true, [], words);
		  while (words_tmp.length > 0) {
			var num = Math.floor(Math.random() * words_tmp.length);
			play_words.push(words_tmp[num]);
			words_tmp = pop_array(words_tmp, num);
		  }


		  // Recompte les paraules de la partida per crear la llista lateral
		  $('#id_word_list tbody').empty();

		  for (var t = 0; t < play_words.length; t++) {

			play_words[t].attempts = 0;
			play_words[t].res_ok = 0;

			$('<tr> <td>' + (t + 1) + '</td> '
			+ ' <td>' + play_words[t].word + '</td> '
			+ ' <td>' + play_words[t].tipus + '</td>'
			+ ' <td>' + play_words[t].meaning + '</td>'
			+ ' </tr>')
			.appendTo('#id_word_list tbody');
		  }

		  $('#id_word_list td:first-child')
			.css('text-align', 'center')
			.next().css('text-align', 'left').css('padding-left', '8px')
			.next().css('text-align', 'center');

		  // Inicialitza comptadors de la partida
		  total_punts   = 0;
		  num_quest  	  = 0;
		  temps_partida = 90;

		  actualitzar_marcador();
		  preparar_pregunta();

		}


		/******************************************************************************/
		/* Funció per passar a la següent pregunta                                    */
		/******************************************************************************/
		function next_question() {

		  num_quest++;
		  // while ((play_words[num_quest].res_ok > 0) && (num_quest < play_words.length)) { alert('num_quest = ' + num_quest + ' +1'); num_quest++; }

		  if (num_quest >= play_words.length) {
			// alert('fi - ' + play_words.length);

			// Comprovar si totes les respostes son correctes
			var all_correct = true;
			for (var t = 0; t < play_words.length; t++) {
			  // alert('play_words[' + t + '].res_ok = ' + play_words[t].res_ok);
			  if (play_words[t].res_ok == 0) { all_correct = false; }
			}

			if (all_correct) {
			  alert ('Congrats: you answer all ok !');
			  finalitzar_partida();
			  return;

			} else {
			  num_quest = 0;
			}

		  }

		  if (play_words[num_quest].res_ok > 0) next_question();  // Salta recursivament a buscar la següent paraula no resposta correctament
		  else    preparar_pregunta();

		}


		/******************************************************************************/
		/* Funció per passar a la següent pregunta                                    */
		/******************************************************************************/
		function finalitzar_partida() {
		  $('#id_div_joc').hide();
		  $('#id_div_inici').show();
		  $('#start_button').focus();
		}


		/******************************************************************************/
		/* Funció per comprovar si la resposta és correcta, i procedir segons         */
		/******************************************************************************/
		function test_answer() {
		  var col_ori = $('#id_div_respostes').css('background-color');
		  var ques_result = false;
		  var ans_value = iron_up_str($('#id_resposta').val());          // Obté la resposta introduida (sense accents)
		  var good_answers = play_words[num_quest].meaning.split(',');   // Obté un array amb totes les possibles respostes correctes

		  alert('good_answers.length = ' + good_answers.length);

		  // Comprova una a una si la resposta és correcte
		  for (var t = 0; t < (good_answers.length); t++) {
			if (ans_value == iron_up_str(good_answers[t])) ques_result = true;
			// alert('ans_value=' + ans_value + ', good_answers=' + good_answers);
		  }

		  if (ans_value == '1') ques_result = true; // Easter egg
		  if (ans_value == '0') ques_result = false;


		  if (ques_result) { // Resposta correcta:

			$('#id_div_respostes')
			  .css('background-color', '#00ff00')
			  .animate({backgroundColor: col_ori}, 200, 'swing', correct_answer);

		  } else { // Resposta incorrecta:

			$('#id_div_respostes')
			  .css('background-color', '#ff0000')
			  .animate({backgroundColor: col_ori}, 200, 'swing', incorrect_answer);
		  }

		}


		/******************************************************************************/
		/* Funció a executar si la resposta és correcte                               */
		/******************************************************************************/
		function correct_answer() {

		  $('#id_word_list tbody tr:eq(' + num_quest + ')').css('background-color', '#44ff44');  // Marcar la paraula de la llista en verd
		  play_words[num_quest].res_ok = 1;
		  play_words[num_quest].attempts++;
		  next_question();
		  actualitzar_marcador();
		  $('#id_resposta').css('background-color', '#ffffff');
		}

		/******************************************************************************/
		/* Funció a executar si la resposta NO és correcte                             */
		/******************************************************************************/
		function incorrect_answer() {

		  $('#id_word_list tbody tr:eq(' + num_quest + ')').css('background-color', '#ff4444');  // Marcar la paraula de la llista en vermell
		  $('#id_resposta').css('background-color', 'red').select();
		  actualitzar_marcador();
		}


		/******************************************************************************/
		/* Funció per passar a següent pregunta quan no se sap la resposta,           */
		/* marcant-la com a erronia i mostrant el resultat                            */
		/******************************************************************************/
		function answer_skip() {

		  alert(play_words[num_quest].word + ' --> ' + play_words[num_quest].meaning);

		  $('#id_word_list tbody tr:eq(' + num_quest + ')').css('background-color', '#ff4444'); // Marcar la paraula de la llista en vermell
		  play_words[num_quest].attempts++;
		  actualitzar_marcador();
		  next_question();
		}



		/******************************************************************************/
		/* Funció per controlar el que s'escriu com a resposta                        */
		/******************************************************************************/
		function answer_key_pres(ev) {
		  $('#id_resposta').css('background-color', 'white');
		  if (ev.keyCode == 13) {
		  if ( $('#id_resposta').val() == '') answer_skip();
		  else 								test_answer();
		  }
		}


		/******************************************************************************/
		/* Funció per visualitzar la següent pregunta                                 */
		/******************************************************************************/
		function preparar_pregunta() {
		  $('#id_word').text((num_quest + 1) + ' - ' + play_words[num_quest].word);
		  $('#id_kind_word').text((num_quest + 1) + ' - ' + play_words[num_quest].tipus);
		  $('#id_resposta').css('background-color', 'white').val('').focus();
		  $('#id_word_list tbody tr:eq(' + num_quest + ')').css('background-color', 'yellow');  // Marcar la paraula de la llista en groc
		}

		/******************************************************************************/
		/* Funció per visualitzar valors del comptador                                */
		/******************************************************************************/
		function actualitzar_marcador() {
		  var total_attempts = 0;
		  var total_res_ok = 0;

		  for (var t = 0; t < play_words.length; t++) {
			total_attempts += play_words[t].attempts;
			total_res_ok += play_words[t].res_ok;
		  }

		  $('#id_scores > span:first')
			.text('Words left: ' + (play_words.length - total_res_ok)
						 + ' / ' + play_words.length)
			.next().text('Attempts: ' + total_attempts)
			.next().text('Hits: '     + total_res_ok)
			.next().text('Errors: '   + (total_attempts - total_res_ok));
		}
	</script>

</head>


<body style="width: 100%; height: 100%;">

	<div id="id_div_joc" class="div_pantalla" style="display: none; width: 100%; height: 100%">

		<div style="
				width: 95%; height: 40px;
				padding: 15px;
				font-size: 20px;
				display: flex;
				flex-flow: column wrap;
				align-content: space-between;
				">
			<div>
				<p id="id_scores">
					<span style="margin-left: 0px;" 			  > Answers: 0/20 </span>
					<span style="margin-left: 30px; color: blue;" > Score: 0 </span>
					<span style="margin-left: 30px; color: green;"> Hits: 0 </span>
					<span style="margin-left: 30px; color: red;"  > Errors: 0 </span>
				</p>
			</div>
			<div>
				<p id="id_time">
					<span> Time: 00 </span>
				</p>
			</div>
		</div>

		<div style="
				width: 95%; height: 800px;
				padding: 15px;
				display: flex;
				flex-flow: column wrap;
				align-items: stretch;
				align-content: space-between;
				">
			<div style="width: 35%; height: 100%; padding: 10px; border: 1px solid black; overflow: auto;">
				<p> llisa lateral </p>

				<table id="id_word_list">
					<thead>
						<tr>
							<th style="width:  30px; text-align: center;"></th>
							<th style="width: 200px; text-align: left; padding-left: 8px;">word</th>
							<th style="width:  40px; text-align: center;">type</th>
						</tr>
					</thead>
					<tbody></tbody>
				</table>
			</div>

			<div style="width: 60%; height: 100%; margin: 10px;">
				<div id="id_div_question" style="font-size: 40px; width: 80%; margin-left: 30px;">
					<p id="id_word">cought</p>
					<p id="id_kind_word" style="font-size: 16px; color: #00AA00;">Verb</p>
				</div>

				<div id="id_div_respostes" style="padding: 10px; font-size: 25px; width:80%; margin-left: 30px;">
					<input type="text" id="id_resposta" onkeydown="answer_key_pres(event);"	style="width: 300px; font-size: 25px;"></input> <br/>

					<input type="button" value="Next" 	onclick="answer_question()"	style="width: 65px; height: 35px;"/>
					<input type="button" value="Help" 	onclick="answer_help()"		disabled="true"	style="width: 65px; height: 35px; margin-left: 120px;"/>
					<input type="button" value="?" 		onclick="answer_question()"	disabled="true" style="width: 35px; height: 35px;"/>
					<!-- <input type="button" value="Ok" 	onclick="test_answer()"		style="width: 35px; height: 35px;"/> -->
				</div>
			</div>

		</div>

	</div>

	<div id="id_div_inici" class="div_pantalla">
		<h1> Vocabulary Test</h2>
		<input id="start_button" type="button" value="START!" style="font-size: 30px; padding:15px;"/>
	</div>



</body>

</html>
