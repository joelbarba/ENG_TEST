<!DOCTYPE html>
<html>
<head>

	<style>

		body {
			font-family: Verdana;
			background-color: #d0e4fe;
		}

		.div_pantalla {
			display			: flex;
			flex-flow		: column wrap;
			align-items		: center;
			align-content	: center;
		}

		.opcio {
			background-color: #e4fed0;
			padding			: 12px;
			width			: 90%;
			border: solid 3px #d0e4fe;
		}

		.opcio_sel {
			// background-color: #eeee88;
			cursor 			: pointer;
			border: solid 3px #888888;
		}

		.opcio_error {
			background-color: #ee5555;
			border: solid 3px #ee2222;
		}

		.opcio_ok {
			background-color: #55cc55;
			border: solid 3px #33ff33;
		}



	</style>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>

  	<script src="jquery-ui/jquery-ui.js"></script>

	<script src="word_list.js"></script>

	<script>

		// https://www.englishclub.com/vocabulary/phrasal-verbs-list.htm



		// var play_verbs =(JSON.parse(JSON.stringify(verbs)));
		var play_words = $.extend(true, [], words);

		var num_quest;
		var resposta_correcta;
		var resultats_erronis = [];
		var total_punts;
		var total_errors;
		var total_encerts;
		var contador_timer;
		var temps_partida;




		// Retorna un array (llista) sense l'objecte de la posició num
		// (re-ubicant els següents objectes per no deixar la posició buida)
		function pop_array(llista, num) {
			return llista.slice(0, num).concat(llista.slice(num + 1));
		}


		$(document).ready(function() {


			// alert ('ini');

			$('.opcio').hover(
				function() { $(this).addClass('opcio_sel');		}, // mouseenter
				function() { $(this).removeClass('opcio_sel'); 	}  // mouseleave
			);

			$('#start_button').click(iniciar_partida);

			// $('#start_button').click();

		});



		function iniciar_partida() {

			$('body > div:first').show().next().hide().end().children().show();

			// Reordenar llista play_words
			var words_tmp = $.extend(true, [], words);
			play_words = [];

			while (words_tmp.length > 0) {
				var num = Math.floor(Math.random() * words_tmp.length);
				play_words.push(words_tmp[num]);
				words_tmp = pop_array(words_tmp, num);
			}

			// Inicialitzar el contador de resultats
			resultats_erronis = new Array(play_words.length);
			for (var t = 0; t < resultats_erronis.length; ++t)  resultats_erronis[t] = 0;

			total_punts   = 0;
			total_errors  = 0;
			total_encerts = 0;
			num_quest  	  = 0;
			num_try  	  = 0;
			temps_partida = 90;
			actualitzar_marcador();


			// $('#id_time > span').text('Time: ' + temps_partida);
			//
			// // Iniciar comptador temps
			// contador_timer = setInterval(function() {
			// 	temps_partida--;
			// 	$('#id_time > span').text('Time: ' + temps_partida);
			// 	if (temps_partida <= 0) { // Temps esgotat:
			// 		finalitzar_partida(false);
			// 	}
			// }, 1000);

			preparar_pregunta();

		}

		// function finalitzar_partida(pf) {
		//
		// 	$('#id_div_respostes').hide().prev().hide();
		// 	$('body > div:first').next().show();
		// 	clearInterval(contador_timer);
		//
		// 	var final_text = pf ? 'WELL DONE!' : 'GAME OVER';
		//
		// 	$('h1').text(final_text).next().attr('value', 'Try again');
		//
		// }


		function actualitzar_marcador() {
			$('#id_scores > span:first')
				.text('Words left: ' + words.length
							 + ' / ' + play_words.length
							 + ' / ' + (num_try + 1))
				.next().text('Score: '  + total_punts)
				.next().text('Hits: '   + total_encerts)
				.next().text('Errors: ' + total_errors);
		}

		function recycle_list() {
			// Delete answers with no mistakes
			for (var t = play_words.length - 1; t >= 0; t--) {
				if (play_words[t].res_ok > 0) {
					play_words = pop_array(play_words, t);
				}
			}

			if (play_words.length == 0) {
				alert ('Congrats: you answer all!');
			} else {

				// Reorder all word left
				var words_tmp = $.extend(true, [], play_words);
				play_words = [];

				while (words_tmp.length > 0) {
					var num = Math.floor(Math.random() * words_tmp.length);
					play_words.push(words_tmp[num]);
					words_tmp = pop_array(words_tmp, num);
				}

				num_quest = 0;
				preparar_pregunta();
			}

		}





		function preparar_pregunta() {
			$('#id_word').text((num_quest + 1) + ' - ' + play_words[num_quest].word);
			$('#id_kind_word').text((num_quest + 1) + ' - ' + play_words[num_quest].tipus);
			$('#id_resposta').val('').focus();
		}

		function test_answer() {
			var col_ori = $('#id_div_respostes').css('background-color');
			var ans_value = $('#id_resposta').val();


			ans_value = ans_value
							.replace(/à/g, "a")
							.replace(/é/g, "e")
							.replace(/è/g, "e")
							.replace(/í/g, "i")
							.replace(/ó/g, "o")
							.replace(/ò/g, "o")
							.replace(/ú/g, "u");

			var good_answ = play_words[num_quest].meaning;
			for (var t = 0; t < good_answ.length; t++) {
				good_answ[t] = good_answ[t]
								.replace(/à/g, "a")
								.replace(/é/g, "e")
								.replace(/è/g, "e")
								.replace(/í/g, "i")
								.replace(/ó/g, "o")
								.replace(/ò/g, "o")
								.replace(/ú/g, "u");
			}


			if (good_answ.indexOf(ans_value, 0) > -1) {
				// Resposta correcta
				$('#id_div_respostes')
					.css('background-color', '#00ff00')
					.animate({backgroundColor: col_ori}, 200, 'swing', function() {
						// A executar quan acaba la animació
						play_words[num_quest].res_ok++;
						total_encerts++;
						next_question();
						actualitzar_marcador();
						$('#id_resposta').css('background-color', '#ffffff');
					} );


			} else {
				// Resposta incorrecta
				$('#id_div_respostes')
					.css('background-color', '#ff0000')
					.animate({backgroundColor: col_ori}, 200, 'swing', function() {
						// A executar quan acaba la animació
						$('#id_resposta').css('background-color', 'red').select();
						play_words[num_quest].res_ko++;
						total_errors++;
						actualitzar_marcador();
					} );

			}


		}

		function next_question() {
			if (num_quest < play_words.length - 1) {
				num_quest++;
				num_try++;
				preparar_pregunta();
			} else {
				recycle_list();
			}
		}



		function answer_key_pres(ev) {
			$('#id_resposta').css('background-color', 'white');
			if (ev.keyCode == 13) {
				if ( $('#id_resposta').val() == '') answer_question();
				else 								test_answer();
			}
		}

		function answer_help() {
			// $('#id_div_question').stop().animate({backgroundColor:'#4E1402'}, 3000);
			// $('#id_div_respostes').css('background-color', '#00ff00').animate({backgroundColor: "#d0e4fe"}, 300 );

		}

		function answer_question() {
			var resp_text = '';
			for (var t = 0; t < play_words[num_quest].meaning.length; t++) {
				if (t > 0) resp_text += ' / ';
				resp_text += play_words[num_quest].meaning[t];
			}
			alert(play_words[num_quest].word + ' --> ' + resp_text);
			next_question();
		}


	</script>

</head>


<body>




	<div class="div_pantalla" style="display: none;">

		<div style="
				width: 95%; height: 40px;
				padding: 15px;
				font-size: 20px;
				display: flex;
				flex-flow: column wrap;
				align-content: space-between;
				">
			<div>
				<p id="id_scores">
					<span style="margin-left: 0px;" 			  > Answers: 0/20 </span>
					<span style="margin-left: 30px; color: blue;" > Score: 0 </span>
					<span style="margin-left: 30px; color: green;"> Hits: 0 </span>
					<span style="margin-left: 30px; color: red;"  > Errors: 0 </span>
				</p>
			</div>
			<div>
				<p id="id_time">
					<span> Time: 00 </span>
				</p>
			</div>
		</div>

		<div id="id_div_question" style="font-size: 40px; width: 80%; margin-left: 30px;">
			<p id="id_word">cought</p>
			<p id="id_kind_word" style="font-size: 16px; color: #00AA00;">Verb</p>
		</div>

		<div id="id_div_respostes" style="padding: 10px; font-size: 25px; width:80%; margin-left: 30px;">
			<input type="text" id="id_resposta" onkeydown="answer_key_pres(event);"	style="width: 300px; font-size: 25px;"></input> <br/>

			<input type="button" value="Next" 	onclick="answer_question()"	style="width: 65px; height: 35px;"/>
			<input type="button" value="Help" 	onclick="answer_help()"		disabled="true"	style="width: 65px; height: 35px; margin-left: 120px;"/>
			<input type="button" value="?" 		onclick="answer_question()"	disabled="true" style="width: 35px; height: 35px;"/>
			<!-- <input type="button" value="Ok" 	onclick="test_answer()"		style="width: 35px; height: 35px;"/> -->
		</div>

	</div>

	<div class="div_pantalla">
		<h1> Vocabulary Test</h2>
		<input id="start_button" type="button" value="START!" style="font-size: 30px; padding:15px;"/>
	</div>



</body>

</html>
